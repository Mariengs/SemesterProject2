import{t as B,u as D,A as N}from"./navbar-BxfGq1EY.js";import{s as j,a as M,f as S}from"./logout-inusWMmd.js";import{u as P}from"./authHelpers-CkD57fEK.js";document.addEventListener("DOMContentLoaded",function(){B(),D(),j(),M(),S(),P()});const L=document.getElementById("listing-container");L.className="w-full flex justify-center px-4";const T=new URLSearchParams(window.location.search),k=T.get("id");k?K(k):$("No listing ID provided in the URL.");function $(e){const t=document.createElement("p");t.textContent=e,t.classList.add("text-red-400","text-center","mt-4"),L.appendChild(t)}function I(e){const t=document.createElement("p");return t.textContent=e,t.className="text-gray-300 mb-2",t}function C(e,t){const n=document.createElement("button");return n.textContent=e,n.className=`${t} font-semibold py-2 px-4 rounded transition`,n}function F(e){const t=Math.floor((new Date-new Date(e))/1e3),n=Math.floor(t/60),s=Math.floor(n/60),r=Math.floor(s/24);return r>0?`${r}d ago`:s>0?`${s}h ago`:n>0?`${n}m ago`:"Just now"}function O(e){const t=document.createElement("section");t.className="bg-gray-700 rounded-md p-6 mt-6 shadow w-full max-w-xl";const n=document.createElement("h2");if(n.textContent="Last 5 bids",n.className="text-lg font-semibold text-white mb-3 text-center",t.appendChild(n),e.length===0){const s=document.createElement("p");s.textContent="No bids yet.",s.className="text-gray-400 text-center",t.appendChild(s)}else[...e].sort((r,p)=>new Date(p.created)-new Date(r.created)).slice(0,5).forEach((r,p)=>{var g;const d=document.createElement("div");d.className=`flex flex-col sm:flex-row sm:justify-between sm:items-center px-6 py-3 rounded border border-gray-600 ${p%2===0?"bg-gray-800":"bg-gray-600"}`;const m=document.createElement("div");m.className="text-white font-medium",m.textContent=((g=r.bidder)==null?void 0:g.name)||"Anonymous";const h=document.createElement("div");h.className="flex flex-col sm:flex-row sm:items-center gap-2 text-sm sm:text-base";const u=document.createElement("span");u.className="text-green-400 font-semibold",u.textContent=`${r.amount} kr`;const l=document.createElement("span");l.className="text-gray-400 italic",l.textContent=F(r.created),h.append(u,l),d.append(m,h),t.appendChild(d)});return t}function z(e,t){const n=document.createElement("button");n.type="button",n.textContent="Place a bid",n.className="btn-bid",n.setAttribute("aria-label","Place a bid"),n.addEventListener("click",()=>{R(e.id,t)});const s=document.createElement("div");return s.className="mt-6 flex justify-center",s.appendChild(n),s}function R(e,t){const n=document.createElement("div");n.className="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50";const s=document.createElement("div");s.className="bg-gray-800 p-6 rounded-lg w-full max-w-sm relative shadow-lg";const r=document.createElement("button");r.textContent="✕",r.className="absolute top-2 right-2 text-white text-xl hover:text-red-400",r.addEventListener("click",()=>document.body.removeChild(n));const p=document.createElement("h2");p.textContent="Place your bid",p.className="text-white text-xl font-bold mb-2 text-center";const d=document.createElement("p");d.className="text-gray-300 text-center mb-4",d.textContent="Loading highest bid...",fetch(`https://v2.api.noroff.dev/auction/listings/${e}?_bids=true`).then(x=>x.json()).then(({data:x})=>{const f=x.bids.length>0?Math.max(...x.bids.map(i=>i.amount)):0;d.textContent=`Highest bid: ${f} kr`}).catch(()=>{d.textContent="Could not load highest bid."});const m=document.createElement("input");m.type="number",m.placeholder="Enter amount (kr)",m.className="w-full p-2 rounded bg-gray-700 text-white border border-gray-600 mb-2";const h=document.createElement("p");h.className="text-red-400 text-sm mb-2 hidden";const u=document.createElement("div");u.className="flex justify-between gap-4 mt-4";const l=C("Cancel","bg-gray-600 hover:bg-gray-700");l.addEventListener("click",()=>document.body.removeChild(n));const g=C("Submit","bg-green-600 hover:bg-green-700");g.addEventListener("click",async()=>{var f,i;const x=Number(m.value);if(!x||x<=0){h.textContent="Please enter a valid bid amount.",h.classList.remove("hidden");return}try{const o=await fetch(`https://v2.api.noroff.dev/auction/listings/${e}/bids`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`,"X-Noroff-API-Key":N},body:JSON.stringify({amount:x})});if(!o.ok){const c=await o.json();throw new Error(((i=(f=c.errors)==null?void 0:f[0])==null?void 0:i.message)||"Bid failed.")}alert("Your bid was successfully placed!"),document.body.removeChild(n),window.location.reload()}catch(o){h.textContent="Error: "+o.message,h.classList.remove("hidden")}}),u.append(l,g),s.append(r,p,d,m,h,u),n.appendChild(s),document.body.appendChild(n)}function J(e,t,n,s){const r=document.createElement("form");r.className="space-y-4 mt-4 p-4 bg-gray-700 rounded-lg shadow-lg";const p=document.createElement("input");p.type="text",p.value=e.title,p.className="w-full p-2 border rounded bg-gray-800 text-white border-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500",r.appendChild(p);const d=document.createElement("textarea");d.value=e.description||"",d.className="w-full p-2 border rounded bg-gray-800 text-white border-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500",r.appendChild(d);const m=document.createElement("div");m.className="space-y-4";const h=(f="")=>{const i=document.createElement("div");i.className="flex flex-col space-y-2";const o=document.createElement("div");o.className="flex items-center gap-2";const c=document.createElement("input");c.type="url",c.value=f,c.placeholder="Enter image URL",c.className="w-full p-2 border rounded bg-gray-800 text-white border-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500";const a=document.createElement("button");a.type="button",a.textContent="✕",a.className="text-white text-lg hover:text-red-400 bg-gray-800 px-3 py-1 rounded border border-gray-500",a.addEventListener("click",()=>{i.remove()}),o.appendChild(c),o.appendChild(a);const b=document.createElement("img");b.className="w-full max-h-64 object-contain rounded border border-gray-600 hidden",E(f)&&(b.src=f,b.classList.remove("hidden")),c.addEventListener("input",()=>{E(c.value)?(b.src=c.value,b.classList.remove("hidden")):b.classList.add("hidden")}),i.appendChild(o),i.appendChild(b),m.appendChild(i)};(e.media||[]).forEach(f=>{E(f.url)&&h(f.url)}),m.children.length===0&&h("");const u=document.createElement("button");u.type="button",u.textContent="+ Add more images",u.className="px-4 py-2 bg-gray-600 text-white rounded hover:bg-gray-700",u.addEventListener("click",()=>h("")),r.appendChild(m),r.appendChild(u);const l=document.createElement("button");l.textContent="Save Changes",l.className="px-4 py-2 bg-blue-500 text-white rounded mt-4 hover:bg-blue-600";const g=document.createElement("button");g.textContent="Cancel",g.type="button",g.className="px-4 py-2 bg-red-500 text-white rounded mt-4 hover:bg-red-600";const x=document.createElement("div");x.className="flex gap-4",x.appendChild(l),x.appendChild(g),g.addEventListener("click",()=>{r.remove()}),l.addEventListener("click",async f=>{f.preventDefault();const i={};p.value!==e.title&&(i.title=p.value),d.value!==e.description&&(i.description=d.value);const o=m.querySelectorAll("input[type='url']"),c=Array.from(o).map(a=>a.value.trim()).filter(a=>E(a));if(c.length>0&&(i.media=c.map(a=>({url:a}))),Object.keys(i).length===0){alert("No changes made.");return}try{if(!(await fetch(`https://v2.api.noroff.dev/auction/listings/${e.id}`,{method:"PUT",headers:{Authorization:`Bearer ${n}`,"X-Noroff-API-Key":s,"Content-Type":"application/json"},body:JSON.stringify(i)})).ok)throw new Error("Failed to update the listing.");alert("Listing updated!"),window.location.reload()}catch(a){alert(`Error: ${a.message}`)}}),r.appendChild(x),t.appendChild(r)}function E(e){return new RegExp("^(https?:\\/\\/)?([\\w.-]+)+(:\\d+)?(\\/\\S*)?$","i").test(e)}async function K(e){try{const t=await fetch(`https://v2.api.noroff.dev/auction/listings/${e}?_seller=true&_bids=true`),{data:n}=await t.json();U(n)}catch(t){$("Could not load the listing."),console.error(t)}}function U(e){var i;const t=document.createElement("div");t.className="flex flex-col items-center bg-gray-800 p-8 rounded-lg shadow-lg w-full max-w-2xl mx-auto mt-8";const n=document.createElement("h1");n.textContent=e.title,n.className="text-4xl font-bold text-white mb-6 text-center";const s=document.createElement("div");if(s.className="grid grid-cols-1 sm:grid-cols-2 gap-4 mb-6 w-full",e.media.length>0)e.media.forEach(({url:o,alt:c})=>{const a=document.createElement("img");a.src=o,a.alt=c||"Listing image",a.className="w-full h-auto object-cover rounded cursor-pointer border border-gray-600",a.addEventListener("click",()=>f(o,c)),s.appendChild(a)});else{const o=document.createElement("img");o.src="https://via.placeholder.com/600x400?text=No+image",o.alt="No image available",o.className="w-full h-auto object-cover rounded",s.appendChild(o)}const r=I(e.description||"No description provided."),p=I(`Seller: ${((i=e.seller)==null?void 0:i.name)||"Unknown"}`),d=document.createElement("p");d.className="text-gray-300 mb-2";const m=setInterval(()=>{const o=new Date(e.endsAt).getTime()-new Date().getTime();if(o<=0){clearInterval(m),d.textContent="Auction ended.",d.className="text-red-400 text-lg font-semibold text-center mt-2";return}const c=Math.floor(o/(1e3*60*60*24)),a=Math.floor(o/(1e3*60*60)%24),b=Math.floor(o/(1e3*60)%60),y=Math.floor(o/1e3%60);d.textContent=`Time left: ${c}d ${a}h ${b}m ${y}s`},1e3),h=O(e.bids);t.append(n,s,r,p,d,h),L.appendChild(t);const u=JSON.parse(localStorage.getItem("profile")),l=u==null?void 0:u.name,g=localStorage.getItem("accessToken");if(!(new Date(e.endsAt)<new Date)&&(l==null?void 0:l.toLowerCase())!==e.seller.name.toLowerCase()&&g&&t.appendChild(z(e,g)),(l==null?void 0:l.toLowerCase())===e.seller.name.toLowerCase()){const o=document.createElement("div");o.className="flex gap-4 mt-6";const c=C("Edit","bg-blue-600 hover:bg-blue-700 text-white");c.addEventListener("click",()=>{J(e,t,g,N)});const a=C("Delete","bg-red-600 hover:bg-red-700 text-white");a.addEventListener("click",async()=>{var y,v;if(confirm("Are you sure you want to delete this listing?"))try{const w=await fetch(`https://v2.api.noroff.dev/auction/listings/${e.id}`,{method:"DELETE",headers:{Authorization:`Bearer ${g}`,"X-Noroff-API-Key":N}});if(!w.ok){const A=await w.json();throw new Error(((v=(y=A.errors)==null?void 0:y[0])==null?void 0:v.message)||"Delete failed.")}alert("Listing deleted successfully."),window.location.href="/html/profile.html"}catch(w){alert("Error deleting listing: "+w.message)}}),o.append(c,a),t.appendChild(o)}function f(o,c){const a=document.createElement("div");a.className="fixed inset-0 bg-black bg-opacity-75 flex justify-center items-center z-50";const b=document.createElement("div");b.className="relative";const y=document.createElement("img");y.src=o,y.alt=c||"Enlarged image",y.className="max-w-full max-h-[90vh] rounded shadow-lg";const v=document.createElement("button");v.textContent="✕",v.className="absolute top-0 right-0 m-2 text-white text-2xl hover:text-red-400",v.addEventListener("click",()=>{document.body.removeChild(a)}),b.appendChild(y),b.appendChild(v),a.appendChild(b),document.body.appendChild(a)}}
