import{g as U,A as Y,t as W,u as _}from"./navbar-VXXSY6lC.js";import{f as M,s as z,a as K}from"./logout-CgsMzti0.js";import{u as J}from"./authHelpers-BdD6Ax2r.js";const $="https://v2.api.noroff.dev/auction/listings";let O=[],w=[],m=1;const L=21;let T;async function R(a){const o=document.createElement("div");o.id="bidModal",o.classList.add("fixed","top-0","left-0","w-full","h-full","bg-gray-800","bg-opacity-50","flex","justify-center","items-center");const p=document.createElement("div");p.classList.add("bg-gray-900","p-8","rounded-lg","w-96"),o.appendChild(p);const n=document.createElement("h3");n.classList.add("text-2xl","text-center","text-white","mb-4"),n.textContent="Place Your Bid";const t=document.createElement("p");t.classList.add("text-center","text-gray-400","mb-4"),t.textContent="Enter your bid amount for this listing.";const e=document.createElement("input");e.type="number",e.id="bidAmount",e.classList.add("w-full","p-2","rounded-md","mb-4","text-black"),e.placeholder="Enter bid amount",e.min=1;const s=document.createElement("div");s.classList.add("flex","justify-between");const l=document.createElement("button");l.textContent="Place Bid",l.classList.add("bg-blue-500","text-white","px-4","py-2","rounded-md");const r=document.createElement("button");r.textContent="Cancel",r.classList.add("bg-red-500","text-white","px-4","py-2","rounded-md"),s.append(l,r),p.append(n,t,e,s),document.body.appendChild(o),r.addEventListener("click",()=>{document.body.removeChild(o)}),l.addEventListener("click",async()=>{const c=parseFloat(document.getElementById("bidAmount").value);if(isNaN(c)||c<=0){alert("Please enter a valid bid amount.");return}const u=U();if(!u){alert("You are not authenticated.");return}try{const d=await fetch(`${$}/${a}/bids`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${u}`,"X-Noroff-API-Key":Y},body:JSON.stringify({amount:c})}),i=await d.json();d.ok?(alert("Your bid has been placed successfully."),C()):alert(i.message||"Error placing bid."),document.body.removeChild(o)}catch(d){alert("Failed to place bid: "+d.message),console.error("Error placing bid:",d)}})}function V(){const a=document.getElementById("app"),o=document.createElement("div");o.className="relative mb-4 max-w-md mx-auto";const p=document.createElement("span");p.textContent="🔍",p.className="absolute left-3 top-2.5 text-gray-400 pointer-events-none";const n=document.createElement("button");n.textContent="✖️",n.className="absolute right-3 top-2 text-gray-400 hover:text-white hidden",n.setAttribute("type","button");const t=document.createElement("input");t.type="text",t.id="searchInput",t.placeholder="Search by title...",t.className="w-full pl-10 pr-10 py-2 rounded-md bg-gray-800 text-white placeholder-gray-400 border border-gray-600 focus:outline-none focus:ring-2 focus:ring-blue-500 transition",t.addEventListener("input",()=>{const f=t.value.trim();n.classList.toggle("hidden",f===""),m=1,x()}),n.addEventListener("click",()=>{t.value="",n.classList.add("hidden"),m=1,x()}),o.append(p,n,t),a.appendChild(o);const e=document.createElement("select");e.id="sortSelect",e.className="bg-gray-800 text-white border border-gray-600 rounded-md py-2 px-3 mb-6 focus:outline-none focus:ring-2 focus:ring-blue-500 transition block mx-auto",[{value:"none",label:"No sorting"},{value:"newest",label:"Newest First"},{value:"oldest",label:"Oldest First"},{value:"mostBids",label:"Most Bids"},{value:"fewestBids",label:"Fewest Bids"},{value:"highestBid",label:"Highest Bid"},{value:"lowestBid",label:"Lowest Bid"}].forEach(({value:f,label:b})=>{const h=document.createElement("option");h.value=f,h.textContent=b,e.appendChild(h)}),a.appendChild(e);const s=document.createElement("div");s.className="flex items-center justify-center mb-6";const l=document.createElement("input");l.type="checkbox",l.id="activeOnly",l.className="mr-2 rounded text-blue-500 focus:ring-blue-500";const r=document.createElement("label");r.setAttribute("for","activeOnly"),r.textContent="Show only active listings",r.className="text-white",s.appendChild(l),s.appendChild(r),a.appendChild(s);const c=document.createElement("div");c.id="listings",c.className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6",a.appendChild(c);const u=document.createElement("div");u.id="pagination",u.className="flex justify-center items-center gap-4 mt-8";const d=document.createElement("button");d.id="prevPage",d.textContent="Previous",d.className="bg-gray-700 text-white px-4 py-2 rounded-md hover:bg-gray-600";const i=document.createElement("span");i.id="pageInfo",i.className="text-white";const g=document.createElement("button");g.id="nextPage",g.textContent="Next",g.className="bg-gray-700 text-white px-4 py-2 rounded-md hover:bg-gray-600",u.append(d,i,g),a.appendChild(u)}async function C(){try{O=(await(await fetch(`${$}?_bids=true&_sort=created&sortOrder=desc&limit=100`)).json()).data,x()}catch(a){console.error("Error fetching listings:",a)}}function x(){const a=document.getElementById("searchInput").value.toLowerCase(),o=document.getElementById("sortSelect").value,p=document.getElementById("activeOnly").checked;w=O.filter(n=>{const t=n.title.toLowerCase().includes(a),e=new Date(n.endsAt)>new Date;return t&&(!p||e)}),w.sort((n,t)=>{var c,u,d,i,g,f;const e=new Date(n.endsAt)>new Date,s=new Date(t.endsAt)>new Date;if(e&&!s)return-1;if(!e&&s)return 1;const l=(c=n.bids)!=null&&c.length?Math.max(...n.bids.map(b=>b.amount)):0,r=(u=t.bids)!=null&&u.length?Math.max(...t.bids.map(b=>b.amount)):0;switch(o){case"newest":return new Date(t.created)-new Date(n.created);case"oldest":return new Date(n.created)-new Date(t.created);case"mostBids":return(((d=t.bids)==null?void 0:d.length)||0)-(((i=n.bids)==null?void 0:i.length)||0);case"fewestBids":return(((g=n.bids)==null?void 0:g.length)||0)-(((f=t.bids)==null?void 0:f.length)||0);case"highestBid":return r-l;case"lowestBid":return l-r;default:return 0}}),B()}function B(){const a=document.getElementById("listings");a.innerHTML="";const o=!!localStorage.getItem("accessToken"),p=(m-1)*L,n=p+L,t=w.slice(p,n);if(t.length===0){const e=document.createElement("p");e.textContent="No results.",a.appendChild(e);return}t.forEach(e=>{var N,P,A,k,D;const s=document.createElement("div");s.classList.add("bg-gray-800","p-6","rounded-lg","shadow-md","hover:shadow-xl","transition","duration-300","ease-in-out");const l=((P=(N=e.media)==null?void 0:N[0])==null?void 0:P.url)||"https://via.placeholder.com/300x200?text=Ingen+bilde",r=((k=(A=e.media)==null?void 0:A[0])==null?void 0:k.alt)||"Placeholder-image",c=document.createElement("img");c.src=l,c.alt=r,c.loading="lazy",c.classList.add("w-full","h-48","object-cover","rounded-md","mb-4");const u=document.createElement("h3");u.classList.add("text-xl","font-semibold","text-gray-200","mb-2"),u.textContent=e.title;const d=document.createElement("p");d.classList.add("text-gray-400","mb-4"),d.textContent=e.description||"No description.";const i=document.createElement("div");i.classList.add("text-gray-300","mb-4");function g(){const v=new Date().getTime(),E=new Date(e.endsAt).getTime()-v;if(E<0)i.textContent="Auction ended",i.classList.remove("text-gray-300"),i.classList.add("text-red-400","font-semibold"),clearInterval(T);else{const S=Math.floor(E/864e5),F=Math.floor(E%(1e3*60*60*24)/(1e3*60*60)),j=Math.floor(E%(1e3*60*60)/(1e3*60)),H=Math.floor(E%(1e3*60)/1e3);i.textContent=`Time left: ${S}d ${F}h ${j}m ${H}s`,i.classList.remove("text-red-400","font-semibold"),i.classList.add("text-gray-300")}}g(),T=setInterval(g,1e3);const f=(D=e.bids)!=null&&D.length?Math.max(...e.bids.map(v=>v.amount)):0,b=document.createElement("div");b.classList.add("text-xl","font-semibold","text-gray-200","mb-2"),b.innerHTML=`<strong>Highest bid:</strong> ${f} kr`;const h=document.createElement("button");h.type="button",h.textContent="Place Bid",h.className="btn-place-bid",h.setAttribute("aria-label","Place Bid"),h.addEventListener("click",v=>{v.preventDefault(),R(e.id)});const y=document.createElement("button");y.type="button",y.textContent="More Info",y.className="btn-more-info",y.setAttribute("aria-label","More Info"),y.addEventListener("click",v=>{v.preventDefault()}),y.addEventListener("click",()=>{window.location.href=`/html/single-listing.html?id=${e.id}`}),s.append(c,u,d,i,b),o&&s.appendChild(h),s.appendChild(y),a.appendChild(s)}),I()}function I(){const a=document.getElementById("pageInfo"),o=Math.ceil(w.length/L);a.textContent=`Page ${m} of ${o}`,document.getElementById("prevPage").disabled=m===1,document.getElementById("nextPage").disabled=m===o}document.addEventListener("DOMContentLoaded",()=>{V(),C(),M(),window.addEventListener("listingCreated",()=>{C(),M()}),document.getElementById("searchInput").addEventListener("input",()=>{m=1,x()}),document.getElementById("sortSelect").addEventListener("change",()=>{m=1,x()}),document.getElementById("prevPage").addEventListener("click",()=>{m>1&&(m--,B(),I())}),document.getElementById("nextPage").addEventListener("click",()=>{const a=Math.ceil(w.length/L);m<a&&(m++,B(),I(),window.scrollTo(0,0))}),document.getElementById("activeOnly").addEventListener("change",()=>{m=1,x()})});document.addEventListener("DOMContentLoaded",()=>{W(),_(),z(),K(),J()});
