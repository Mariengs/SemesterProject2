import{t as h,u as L,g as E,A as b}from"./navbar-BitGk6o4.js";import{s as w,a as x,f as I}from"./logout-C_9aJbEF.js";const g=document.getElementById("create-listing-form"),c=document.getElementById("form-message"),y=document.getElementById("media-wrapper"),p=document.getElementById("add-image-button");document.addEventListener("DOMContentLoaded",()=>{h(),L(),w(),x(),I()});p==null||p.addEventListener("click",()=>{const n=document.createElement("div");n.className="mt-4 space-y-2 border border-gray-700 p-4 rounded",n.classList.add("media-item");const s=document.createElement("div");s.className="flex items-center gap-2 w-full";const t=document.createElement("input");t.type="url",t.placeholder="Image URL",t.className="flex-1 p-2 rounded bg-gray-800 text-white border border-gray-600",t.required=!1;const d=document.createElement("button");d.type="button",d.textContent="âœ•",d.className="text-white bg-red-600 rounded px-2 py-1 hover:bg-red-700 text-sm",d.addEventListener("click",()=>{n.remove()}),s.append(t,d);const e=document.createElement("img");e.className="w-24 h-24 object-cover rounded border border-gray-600 hidden mt-2",e.alt="Preview";const a=document.createElement("p");a.className="text-red-500 text-sm hidden",a.textContent="Could not load image.",n.append(s,e,a),y.appendChild(n);function l(o){if(!o){e.classList.add("hidden"),a.classList.add("hidden"),e.removeAttribute("src");return}e.src=o,e.classList.add("hidden")}t.addEventListener("input",()=>{l(t.value.trim())}),t.addEventListener("paste",o=>{o.preventDefault();const i=(o.clipboardData||window.clipboardData).getData("text").trim();t.value=i,l(i)}),e.onload=()=>{e.classList.remove("hidden"),a.classList.add("hidden")},e.onerror=()=>{e.classList.add("hidden"),a.classList.remove("hidden")}});g==null||g.addEventListener("submit",async n=>{var u,i;n.preventDefault();const s=E();if(!s){f("You must be logged in to create a listing.","red");return}const t=document.getElementById("title").value.trim(),d=document.getElementById("description").value.trim();let e=document.getElementById("endsAt").value;e=new Date(e).toISOString();const a=Array.from(y.children).filter(r=>r.classList.contains("media-item")),l=Array.from(a).map(r=>{var v;const m=(v=r.querySelector("input[type='url']"))==null?void 0:v.value.trim();return m?{url:m,alt:"Listing image"}:null}).filter(Boolean),o={title:t,description:d,media:l,endsAt:e};try{const r=await fetch("https://v2.api.noroff.dev/auction/listings",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${s}`,"X-Noroff-API-Key":b},body:JSON.stringify(o)}),m=await r.json();if(r.ok)f("Listing created successfully! Redirecting...","green"),setTimeout(()=>{window.location.href="/"},1e3);else throw new Error(((i=(u=m.errors)==null?void 0:u[0])==null?void 0:i.message)||"Failed to create listing")}catch(r){f(r.message,"red")}});function f(n,s){c.textContent=n,c.className="",s==="red"?c.classList.add("text-red-500"):s==="green"?c.classList.add("text-green-500"):c.classList.add("text-gray-500")}
