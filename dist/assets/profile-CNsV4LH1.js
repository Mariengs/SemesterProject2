import{t as I,u as k,A as j}from"./navbar-CV3-IAa4.js";import{s as M,a as P,f as D}from"./logout-DI3KsR8W.js";document.addEventListener("DOMContentLoaded",()=>{I(),M(),P(),k(),B(),D()});async function B(){const e=document.getElementById("profileContainer"),t=localStorage.getItem("accessToken"),r=localStorage.getItem("userName"),n=j;if(!t||!r){$(e,"You must be logged in to view your profile.");return}try{const a=await F(r,t,n);T(e,a);const d=N(e,"myListings"),i=N(e,"myBids"),o=N(e,"wonBids");await Promise.all([z(r,t,n,d),V(r,t,n,i,o),K(r,t,n,o)])}catch(a){$(e,`Could not load profile: ${a.message}`)}}async function F(e,t,r){const n=await fetch(`https://v2.api.noroff.dev/auction/profiles/${e}`,{headers:{Authorization:`Bearer ${t}`,"X-Noroff-API-Key":r}});if(!n.ok)throw new Error("Failed to fetch profile information.");const{data:a}=await n.json();return a}function T(e,t){var d,i,o,s;e.innerHTML="";const r=((d=t.banner)==null?void 0:d.url)||"https://via.placeholder.com/800x200",n=((i=t.avatar)==null?void 0:i.url)||"https://via.placeholder.com/100";e.appendChild(C(r,((o=t.banner)==null?void 0:o.alt)||"Banner","w-full h-48 object-cover rounded-lg mb-4")),e.appendChild(C(n,((s=t.avatar)==null?void 0:s.alt)||"Avatar","w-24 h-24 rounded-full mx-auto border-4 border-gray-700 -mt-16 bg-gray-900 object-cover")),e.appendChild(c("h1",t.name,"text-2xl font-bold mt-4 text-center")),e.appendChild(c("p",t.email,"text-gray-400 text-center")),e.appendChild(c("p",t.bio||"No bio available.","text-gray-400 text-center")),e.appendChild(c("p",`Credits: ${t.credits}`,"text-lg font-semibold text-green-400 text-center mt-2"));const a=document.createElement("button");a.textContent="Edit Profile",a.className="mt-4 px-4 py-2 bg-blue-500 text-white rounded",a.addEventListener("click",()=>{window.location.href="/html/edit-profile.html"}),e.appendChild(a)}function C(e,t,r){const n=document.createElement("img");return n.src=e,n.alt=t,n.className=r,n}function c(e,t,r){const n=document.createElement(e);return n.textContent=t,n.className=r,n}function $(e,t){e.innerHTML="";const r=document.createElement("p");r.textContent=t,r.className="text-red-500",e.appendChild(r)}function N(e,t){const r=document.createElement("section");r.className="mt-8 bg-gray-900 rounded-lg shadow-lg border border-gray-700 overflow-hidden";const n=document.createElement("button");n.className="w-full text-left px-6 py-4 bg-gray-800 hover:bg-gray-700 text-xl font-semibold text-white flex justify-between items-center focus:outline-none",n.setAttribute("aria-expanded","true");const a={myListings:"My Listings",myBids:"Listings I've Bid On",wonBids:"Auctions I've Won"}[t]||"Section",d=document.createElement("span");d.textContent=a;const i=document.createElement("span");i.textContent="−",i.className="text-lg transition-transform duration-200",n.append(d,i),r.appendChild(n);const o=document.createElement("div");return o.id=t,o.className="px-6 pb-6 pt-4",r.appendChild(o),n.addEventListener("click",()=>{const s=n.getAttribute("aria-expanded")==="true";n.setAttribute("aria-expanded",String(!s)),o.classList.toggle("hidden",s),i.textContent=s?"+":"−"}),e.appendChild(r),o}async function z(e,t,r,n){try{const a=await fetch(`https://v2.api.noroff.dev/auction/profiles/${e}/listings`,{headers:{Authorization:`Bearer ${t}`,"X-Noroff-API-Key":r}});if(!a.ok)throw new Error("Failed to fetch listings.");const{data:d}=await a.json();if(n.appendChild(c("h2","My Listings","text-xl font-bold text-center")),d.length===0){n.appendChild(c("p","You have no listings yet.","text-gray-500 text-center"));return}d.forEach(i=>{var y,p;const o=document.createElement("div");o.className="bg-gray-800 p-4 rounded-lg shadow-md mb-6",o.appendChild(c("h3",i.title,"text-lg font-semibold text-white"));const s=((p=(y=i.media)==null?void 0:y[0])==null?void 0:p.url)||"https://via.placeholder.com/400x300";o.appendChild(C(s,i.title,"w-full h-48 object-cover rounded-lg mb-4")),o.appendChild(c("p",i.description||"No description available.","text-gray-400"));const l=document.createElement("a");l.href=`/html/single-listing.html?id=${i.id}`,l.textContent="View Listing",l.className="text-blue-500 hover:underline mt-4 inline-block",o.appendChild(l);const f=document.createElement("button");f.textContent="Edit",f.className="ml-4 text-yellow-500 hover:underline inline-block",f.addEventListener("click",()=>{S(i,o,t,r)}),o.appendChild(f);const h=document.createElement("button");h.textContent="Delete",h.className="ml-4 text-red-500 hover:underline inline-block",h.addEventListener("click",async()=>{if(confirm("Are you sure you want to delete this listing?"))try{if(!(await fetch(`https://v2.api.noroff.dev/auction/listings/${i.id}`,{method:"DELETE",headers:{Authorization:`Bearer ${t}`,"X-Noroff-API-Key":r}})).ok)throw new Error("Failed to delete the listing.");o.remove()}catch(m){alert(`Error: ${m.message}`)}}),o.appendChild(h),n.appendChild(o)})}catch(a){n.appendChild(c("p",`Error loading listings: ${a.message}`,"text-red-500"))}}function S(e,t,r,n){const a=document.createElement("form");a.className="space-y-4 mt-4 p-4 bg-gray-700 rounded-lg shadow-lg";const d=document.createElement("input");d.type="text",d.value=e.title||"",d.className="w-full p-2 border rounded bg-gray-800 text-white border-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500",a.appendChild(d);const i=document.createElement("textarea");i.value=e.description||"",i.className="w-full p-2 border rounded bg-gray-800 text-white border-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500",a.appendChild(i);const o=document.createElement("div");o.className="space-y-4";const s=(p="")=>{const m=document.createElement("div");m.className="flex flex-col space-y-2";const x=document.createElement("div");x.className="flex items-center gap-2";const b=document.createElement("input");b.type="url",b.value=p,b.placeholder="Enter image URL",b.className="flex-1 p-2 border rounded bg-gray-800 text-white border-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500";const v=document.createElement("button");v.type="button",v.textContent="✕",v.className="text-white text-lg hover:text-red-400 bg-gray-800 px-2 py-0.5 rounded border border-gray-500",v.addEventListener("click",()=>{m.remove()}),x.appendChild(b),x.appendChild(v);const g=document.createElement("img");g.className="w-[240px] h-[160px] object-cover rounded border border-gray-600 mt-2",g.style.display=p?"block":"none",p&&(g.src=p),b.addEventListener("input",()=>{const w=b.value.trim();w?(g.src=w,g.style.display="block"):g.style.display="none"}),m.appendChild(x),m.appendChild(g),o.appendChild(m)};(e.media||[]).forEach(p=>{typeof p=="string"?s(p):p!=null&&p.url&&s(p.url)}),o.children.length===0&&s("");const l=document.createElement("button");l.type="button",l.textContent="+ Add more images",l.className="px-4 py-2 bg-gray-600 text-white rounded hover:bg-gray-700",l.addEventListener("click",()=>s("")),a.appendChild(o),a.appendChild(l);const f=document.createElement("button");f.type="submit",f.textContent="Save Changes",f.className="px-4 py-2 bg-blue-500 text-white rounded mt-4 hover:bg-blue-600";const h=document.createElement("button");h.textContent="Cancel",h.type="button",h.className="px-4 py-2 bg-red-500 text-white rounded mt-4 hover:bg-red-600";const y=document.createElement("div");y.className="flex justify-center gap-4 mt-4",y.appendChild(f),y.appendChild(h),h.addEventListener("click",()=>{a.remove()}),a.addEventListener("submit",async p=>{var L,A;p.preventDefault();const m={},x=d.value.trim(),b=i.value.trim();x&&x!==e.title&&(m.title=x),(b||"")!==(e.description||"")&&(m.description=b);const v=o.querySelectorAll("input[type='url']"),g=Array.from(v).map(u=>u.value.trim()).filter(u=>R(u)),w=(e.media||[]).map(u=>typeof u=="string"?u:u.url);if((w.length!==g.length||w.some((u,E)=>u!==g[E]))&&g.length>0&&(m.media=g.map(u=>({url:u,alt:x||e.title||"Listing image"}))),Object.keys(m).length===0){alert("No changes made.");return}try{const u=await fetch(`https://v2.api.noroff.dev/auction/listings/${e.id}`,{method:"PUT",headers:{Authorization:`Bearer ${r}`,"X-Noroff-API-Key":n,"Content-Type":"application/json"},body:JSON.stringify(m)});if(!u.ok){const E=await u.json();throw new Error(((A=(L=E.errors)==null?void 0:L[0])==null?void 0:A.message)||"Failed to update the listing.")}alert("Listing updated successfully!"),B()}catch(u){alert(`Error: ${u.message}`)}}),a.appendChild(y),t.appendChild(a)}function R(e){return new RegExp("^(https?:\\/\\/(www\\.)?[-a-zA-Z0-9@:%_\\+.~#?&//=]{2,256}\\.[a-z]{2,6}\\b([-a-zA-Z0-9@:%_\\+.~#?&//=]*)?)$").test(e)}async function K(e,t,r,n){try{n.innerHTML="";const a=await fetch(`https://v2.api.noroff.dev/auction/profiles/${e}/wins`,{headers:{Authorization:`Bearer ${t}`,"X-Noroff-API-Key":r}});if(!a.ok)throw new Error("Failed to fetch won auctions.");const{data:d}=await a.json();if(d.length===0){n.appendChild(c("p","You haven't won any auctions yet.","text-gray-500 text-center"));return}d.forEach(i=>{var f,h;const o=document.createElement("div");o.className="bg-gray-800 p-4 rounded-lg shadow-md mb-6",o.appendChild(c("h3",i.title,"text-lg font-semibold text-white"));const s=((h=(f=i.media)==null?void 0:f[0])==null?void 0:h.url)||"https://via.placeholder.com/400x300";o.appendChild(C(s,i.title,"w-full h-48 object-cover rounded-lg mb-4")),o.appendChild(c("p",i.description||"No description available.","text-gray-400"));const l=document.createElement("a");l.href=`/html/single-listing.html?id=${i.id}`,l.textContent="View Listing",l.className="text-blue-500 hover:underline mt-4 inline-block",o.appendChild(l),n.appendChild(o)})}catch(a){n.appendChild(c("p",`Error loading wins: ${a.message}`,"text-red-500"))}}async function V(e,t,r,n,a){try{const d=await fetch(`https://v2.api.noroff.dev/auction/profiles/${e}/bids?_listings=true`,{headers:{Authorization:`Bearer ${t}`,"X-Noroff-API-Key":r}});if(!d.ok)throw new Error("Failed to fetch bids.");const{data:i}=await d.json();n.appendChild(c("h2","Listings I've Bid On","text-xl font-bold text-center mt-8"));const o=i.filter(s=>new Date(s.listing.endsAt)>new Date);o.length===0?n.appendChild(c("p","You haven't placed any active bids.","text-gray-500 text-center")):o.forEach(s=>{const l=W(s);n.appendChild(l)})}catch(d){n.appendChild(c("p",`Error loading bids: ${d.message}`,"text-red-500"))}}function W(e){var d,i;const t=document.createElement("div");t.className="bg-gray-800 p-4 rounded-lg shadow-md mb-6",t.appendChild(c("h3",e.listing.title,"text-lg font-semibold text-white"));const r=((i=(d=e.listing.media)==null?void 0:d[0])==null?void 0:i.url)||"https://via.placeholder.com/400x300";t.appendChild(C(r,e.listing.title,"w-full h-48 object-cover rounded-lg mb-4")),t.appendChild(c("p",`Your bid: ${e.amount} credits`,"text-gray-400"));const n=X(new Date(e.listing.endsAt));t.appendChild(n);const a=document.createElement("a");return a.href=`/html/single-listing.html?id=${e.listing.id}`,a.textContent="View Listing",a.className="text-blue-500 hover:underline mt-4 inline-block",t.appendChild(a),t}function X(e){const t=document.createElement("p");t.className="text-gray-400";function r(){const d=e-new Date;if(d<=0){t.textContent="Auction ended",clearInterval(n);return}const i=Math.floor(d/(1e3*60*60*24)),o=Math.floor(d/(1e3*60*60)%24),s=Math.floor(d/(1e3*60)%60),l=Math.floor(d/1e3%60);t.textContent=`Ends in: ${i}d ${o}h ${s}m ${l}s`}r();const n=setInterval(r,1e3);return t}
