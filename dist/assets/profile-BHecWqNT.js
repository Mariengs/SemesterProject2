import{t as I,u as k,A as j}from"./navbar-B4jypeQx.js";import{s as P,a as M,f as D}from"./logout-SE-Pe0Xt.js";document.addEventListener("DOMContentLoaded",()=>{I(),P(),M(),k(),$(),D()});async function $(){const e=document.getElementById("profileContainer"),t=localStorage.getItem("accessToken"),r=localStorage.getItem("userName"),n=j;if(!t||!r){B(e,"You must be logged in to view your profile.");return}try{const a=await F(r,t,n);T(e,a);const s=N(e,"myListings"),i=N(e,"myBids"),o=N(e,"wonBids");await Promise.all([U(r,t,n,s),R(r,t,n,i,o),S(r,t,n,o)])}catch(a){B(e,`Could not load profile: ${a.message}`)}}async function F(e,t,r){const n=await fetch(`https://v2.api.noroff.dev/auction/profiles/${e}`,{headers:{Authorization:`Bearer ${t}`,"X-Noroff-API-Key":r}});if(!n.ok)throw new Error("Failed to fetch profile information.");const{data:a}=await n.json();return a}function T(e,t){var s,i,o,c;e.innerHTML="";const r=((s=t.banner)==null?void 0:s.url)||"https://via.placeholder.com/800x200",n=((i=t.avatar)==null?void 0:i.url)||"https://via.placeholder.com/100";e.appendChild(E(r,((o=t.banner)==null?void 0:o.alt)||"Banner","w-full h-48 object-cover rounded-lg mb-4")),e.appendChild(E(n,((c=t.avatar)==null?void 0:c.alt)||"Avatar","w-24 h-24 rounded-full mx-auto border-4 border-gray-700 -mt-16 bg-gray-900 object-cover")),e.appendChild(m("h1",t.name,"text-2xl font-bold mt-4 text-center")),e.appendChild(m("p",t.email,"text-gray-400 text-center")),e.appendChild(m("p",t.bio||"No bio available.","text-gray-400 text-center")),e.appendChild(m("p",`Credits: ${t.credits}`,"text-lg font-semibold text-green-400 text-center mt-2"));const a=document.createElement("button");a.textContent="Edit Profile",a.className="mt-4 px-4 py-2 bg-black hover:bg-gray-700 text-white rounded",a.addEventListener("click",()=>{window.location.href="/html/edit-profile.html"}),e.appendChild(a)}function E(e,t,r){const n=document.createElement("img");return n.src=e,n.alt=t,n.className=r,n}function m(e,t,r){const n=document.createElement(e);return n.textContent=t,n.className=r,n}function B(e,t){e.innerHTML="";const r=document.createElement("p");r.textContent=t,r.className="text-red-500",e.appendChild(r)}function N(e,t){const r=document.createElement("section");r.className="mt-8 bg-gray-900 rounded-lg shadow-lg border border-gray-700 overflow-hidden";const n=document.createElement("button");n.className="w-full text-left px-6 py-4 bg-gray-800 hover:bg-gray-700 text-xl font-semibold text-white flex justify-between items-center focus:outline-none",n.setAttribute("aria-expanded","true");const a={myListings:"My Listings",myBids:"Listings I've Bid On",wonBids:"Auctions I've Won"}[t]||"Section",s=document.createElement("span");s.textContent=a;const i=document.createElement("span");i.textContent="−",i.className="text-lg transition-transform duration-200",n.append(s,i),r.appendChild(n);const o=document.createElement("div");return o.id=t,o.className="px-6 pb-6 pt-4",r.appendChild(o),n.addEventListener("click",()=>{const c=n.getAttribute("aria-expanded")==="true";n.setAttribute("aria-expanded",String(!c)),o.classList.toggle("hidden",c),i.textContent=c?"+":"−"}),e.appendChild(r),o}async function U(e,t,r,n){try{const a=await fetch(`https://v2.api.noroff.dev/auction/profiles/${e}/listings`,{headers:{Authorization:`Bearer ${t}`,"X-Noroff-API-Key":r}});if(!a.ok)throw new Error("Failed to fetch listings.");const{data:s}=await a.json();s.forEach(i=>{var f,p;const o=document.createElement("div");o.className="bg-gray-800 p-4 rounded-lg shadow-md mb-6",o.appendChild(m("h2",i.title,"text-lg font-semibold text-white"));const c=((p=(f=i.media)==null?void 0:f[0])==null?void 0:p.url)||"https://via.placeholder.com/400x300";o.appendChild(E(c,i.title,"w-full h-48 object-cover rounded-lg mb-4")),o.appendChild(m("p",i.description||"No description available.","text-gray-400"));const d=document.createElement("button");d.type="button",d.textContent="View Listing",d.className="btn-view-listing",d.addEventListener("click",()=>{window.location.href=`/html/single-listing.html?id=${i.id}`}),o.appendChild(d);const u=document.createElement("button");u.type="button",u.textContent="Edit",u.className="btn-edit",u.addEventListener("click",()=>{W(i,o,t,r)}),o.appendChild(u);const h=document.createElement("button");h.type="button",h.textContent="Delete",h.className="btn-delete",h.addEventListener("click",async()=>{if(confirm("Are you sure you want to delete this listing?"))try{if(!(await fetch(`https://v2.api.noroff.dev/auction/listings/${i.id}`,{method:"DELETE",headers:{Authorization:`Bearer ${t}`,"X-Noroff-API-Key":r}})).ok)throw new Error("Failed to delete the listing.");o.remove()}catch(b){alert(`Error: ${b.message}`)}}),o.appendChild(h);const g=document.createElement("div");g.className="flex justify-center space-x-4 mt-4",g.append(d,u,h),o.appendChild(g),n.appendChild(o)})}catch(a){n.appendChild(m("p",`Error loading listings: ${a.message}`,"text-red-500"))}}function W(e,t,r,n){const a=document.createElement("form");a.className="space-y-4 mt-4 p-4 bg-gray-700 rounded-lg shadow-lg overflow-x-hidden";const s=document.createElement("input");s.type="text",s.value=e.title||"",s.className="w-full p-2 border rounded bg-gray-800 text-white border-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500",a.appendChild(s);const i=document.createElement("textarea");i.value=e.description||"",i.className="w-full p-2 border rounded bg-gray-800 text-white border-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500",a.appendChild(i);const o=document.createElement("div");o.className="space-y-4 w-full";const c=(f="")=>{const p=document.createElement("div");p.className="flex flex-col space-y-2 w-full";const b=document.createElement("div");b.className="flex items-center gap-2 flex-wrap min-w-0";const x=document.createElement("input");x.type="url",x.value=f,x.placeholder="Enter image URL",x.className="flex-1 min-w-0 p-2 border rounded bg-gray-800 text-white border-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500";const w=document.createElement("button");w.type="button",w.textContent="✕",w.className="px-1 py-0.5 text-sm sm:px-2 sm:py-1 sm:text-base text-white hover:text-red-400 bg-gray-800 rounded border border-gray-500 flex-shrink-0",w.addEventListener("click",()=>p.remove()),b.append(x,w);const y=document.createElement("img");y.className="w-full sm:w-[240px] h-[160px] object-cover rounded border border-gray-600 mt-2",y.style.display=f?"block":"none",f&&(y.src=f),x.addEventListener("input",()=>{const v=x.value.trim();y.style.display=v?"block":"none",v&&(y.src=v)}),p.append(b,y),o.appendChild(p)};(e.media||[]).forEach(f=>{const p=typeof f=="string"?f:f.url;c(p)}),o.children.length||c(""),a.appendChild(o);const d=document.createElement("button");d.type="button",d.textContent="+ Add more images",d.className="px-2 py-1 text-sm sm:px-4 sm:py-2 sm:text-base bg-gray-600 text-white rounded hover:bg-gray-700",d.addEventListener("click",()=>c("")),a.appendChild(d);const u=document.createElement("div");u.className="flex justify-center gap-4 mt-4";const h=document.createElement("button");h.type="submit",h.textContent="Save Changes",h.className="px-2 py-1 text-sm sm:px-4 sm:py-2 sm:text-base bg-blue-500 text-white rounded hover:bg-blue-600";const g=document.createElement("button");g.type="button",g.textContent="Cancel",g.className="px-2 py-1 text-sm sm:px-4 sm:py-2 sm:text-base bg-red-500 text-white rounded hover:bg-red-600",g.addEventListener("click",()=>a.remove()),u.append(h,g),a.appendChild(u),a.addEventListener("submit",async f=>{var L,A;f.preventDefault();const p={},b=s.value.trim(),x=i.value.trim();b&&b!==e.title&&(p.title=b),x!==(e.description||"")&&(p.description=x);const w=o.querySelectorAll("input[type='url']"),y=Array.from(w).map(l=>l.value.trim()).filter(l=>z(l)),v=(e.media||[]).map(l=>typeof l=="string"?l:l.url);if((y.length!==v.length||y.some((l,C)=>l!==v[C]))&&(p.media=y.map(l=>({url:l,alt:b||e.title||"Listing image"}))),!Object.keys(p).length){alert("No changes made.");return}try{const l=await fetch(`https://v2.api.noroff.dev/auction/listings/${e.id}`,{method:"PUT",headers:{Authorization:`Bearer ${r}`,"X-Noroff-API-Key":n,"Content-Type":"application/json"},body:JSON.stringify(p)});if(!l.ok){const C=await l.json();throw new Error(((A=(L=C.errors)==null?void 0:L[0])==null?void 0:A.message)||"Oppdatering feilet.")}alert("Listing updated successfully!"),$()}catch(l){alert(`Error: ${l.message}`)}}),t.appendChild(a)}function z(e){return new RegExp("^(https?:\\/\\/(www\\.)?[-a-zA-Z0-9@:%_\\+.~#?&//=]{2,256}\\.[a-z]{2,6}\\b([-a-zA-Z0-9@:%_\\+.~#?&//=]*)?)$").test(e)}async function S(e,t,r,n){try{n.innerHTML="";const a=await fetch(`https://v2.api.noroff.dev/auction/profiles/${e}/wins`,{headers:{Authorization:`Bearer ${t}`,"X-Noroff-API-Key":r}});if(!a.ok)throw new Error("Failed to fetch won auctions.");const{data:s}=await a.json();if(s.length===0){n.appendChild(m("p","You haven't won any auctions yet.","text-gray-500 text-center"));return}s.forEach(i=>{var h,g;const o=document.createElement("div");o.className="bg-gray-800 p-4 rounded-lg shadow-md mb-6",o.appendChild(m("h3",i.title,"text-lg font-semibold text-white"));const c=((g=(h=i.media)==null?void 0:h[0])==null?void 0:g.url)||"https://via.placeholder.com/400x300";o.appendChild(E(c,i.title,"w-full h-48 object-cover rounded-lg mb-4")),o.appendChild(m("p",i.description||"No description available.","text-gray-400"));const d=document.createElement("button");d.type="button",d.textContent="View Listing",d.className="btn-view-listing",d.addEventListener("click",()=>{window.location.href=`/html/single-listing.html?id=${i.id}`});const u=document.createElement("div");u.className="flex flex-col space-y-2 sm:flex-row sm:space-y-0 sm:space-x-4 justify-center mt-4",u.appendChild(d),o.appendChild(u),n.appendChild(o)})}catch(a){n.appendChild(m("p",`Error loading wins: ${a.message}`,"text-red-500"))}}async function R(e,t,r,n,a){try{const s=await fetch(`https://v2.api.noroff.dev/auction/profiles/${e}/bids?_listings=true`,{headers:{Authorization:`Bearer ${t}`,"X-Noroff-API-Key":r}});if(!s.ok)throw new Error("Failed to fetch bids.");const{data:i}=await s.json(),o=i.filter(c=>new Date(c.listing.endsAt)>new Date);o.length===0?n.appendChild(m("p","You haven't placed any active bids.","text-gray-500 text-center")):o.forEach(c=>{const d=K(c);n.appendChild(d)})}catch(s){n.appendChild(m("p",`Error loading bids: ${s.message}`,"text-red-500"))}}function K(e){var i,o;const t=document.createElement("div");t.className="bg-gray-800 p-4 rounded-lg shadow-md mb-6",t.appendChild(m("h3",e.listing.title,"text-lg font-semibold text-white"));const r=((o=(i=e.listing.media)==null?void 0:i[0])==null?void 0:o.url)||"https://via.placeholder.com/400x300";t.appendChild(E(r,e.listing.title,"w-full h-48 object-cover rounded-lg mb-4")),t.appendChild(m("p",`Your bid: ${e.amount} credits`,"text-gray-400"));const n=V(new Date(e.listing.endsAt));t.appendChild(n);const a=document.createElement("button");a.type="button",a.textContent="View Listing",a.className="btn-view-listing",a.addEventListener("click",()=>{window.location.href=`/html/single-listing.html?id=${e.listing.id}`});const s=document.createElement("div");return s.className="flex flex-col space-y-2 sm:flex-row sm:space-y-0 sm:space-x-4 justify-center mt-4",s.appendChild(a),t.appendChild(s),t}function V(e){const t=document.createElement("p");t.className="text-gray-400";function r(){const s=e-new Date;if(s<=0){t.textContent="Auction ended",clearInterval(n);return}const i=Math.floor(s/(1e3*60*60*24)),o=Math.floor(s/(1e3*60*60)%24),c=Math.floor(s/(1e3*60)%60),d=Math.floor(s/1e3%60);t.textContent=`Ends in: ${i}d ${o}h ${c}m ${d}s`}r();const n=setInterval(r,1e3);return t}
