import{t as v,u as E,g as L,A as w}from"./navbar-S6xofydm.js";import{s as b,a as x,f as C}from"./logout-Cu6HC3oB.js";const m=document.getElementById("create-listing-form"),i=document.getElementById("form-message");document.getElementById("listings-container");const f=document.getElementById("media-wrapper"),a=document.getElementById("add-image-button");document.addEventListener("DOMContentLoaded",()=>{v(),E(),b(),x(),C(),a==null||a.click()});a==null||a.addEventListener("click",()=>{const t=document.createElement("div");t.className="mt-4 space-y-2 border border-gray-700 p-4 rounded";const n=document.createElement("div");n.className="flex items-center gap-2 w-full";const s=document.createElement("input");s.type="url",s.placeholder="Image URL",s.className="flex-1 p-2 rounded bg-gray-800 text-white border border-gray-600",s.required=!1;const o=document.createElement("button");o.type="button",o.textContent="âœ•",o.className="text-white bg-red-600 rounded px-2 py-1 hover:bg-red-700 text-sm",o.addEventListener("click",()=>{t.remove()});const e=document.createElement("img");e.className="h-24 w-24 object-cover rounded border border-gray-600 hidden mt-2",e.alt="Preview";const r=document.createElement("p");r.className="text-red-500 text-sm hidden",r.textContent="Image could not be loaded.",n.appendChild(s),n.appendChild(o),t.appendChild(n),t.appendChild(e),t.appendChild(r),f.appendChild(t),s.addEventListener("input",()=>{const c=s.value.trim();I(c)?(e.src=c,e.onload=()=>{e.classList.remove("hidden"),r.classList.add("hidden")},e.onerror=()=>{e.classList.add("hidden"),r.classList.remove("hidden")}):(e.classList.add("hidden"),r.classList.add("hidden"))})});m==null||m.addEventListener("submit",async t=>{var g,p;t.preventDefault();const n=L();if(!n){u("You must be logged in to create a listing.","red");return}const s=document.getElementById("title").value.trim(),o=document.getElementById("description").value.trim();let e=document.getElementById("endsAt").value;e=new Date(e).toISOString();const r=f.querySelectorAll("div"),c=Array.from(r).map(d=>{var h;const l=(h=d.querySelector("input"))==null?void 0:h.value.trim();return l?{url:l,alt:"Listing image"}:null}).filter(d=>d!==null),y={title:s,description:o,media:c,endsAt:e};try{const d=await fetch("https://v2.api.noroff.dev/auction/listings",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${n}`,"X-Noroff-API-Key":w},body:JSON.stringify(y)}),l=await d.json();if(d.ok)u("Listing created successfully! Redirecting...","green"),setTimeout(()=>{window.dispatchEvent(new CustomEvent("listingCreated")),window.location.href="/"},1e3);else throw new Error(((p=(g=l.errors)==null?void 0:g[0])==null?void 0:p.message)||"Failed to create listing")}catch(d){u(d.message,"red")}});function u(t,n){i.textContent=t,i.className="",n==="red"?i.classList.add("text-red-500"):n==="green"?i.classList.add("text-green-500"):i.classList.add("text-gray-500")}function I(t){return/^https?:\/\/[^\s]+\.(jpg|jpeg|png|gif|webp|svg)$/i.test(t)}
