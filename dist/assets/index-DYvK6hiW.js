(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))s(e);new MutationObserver(e=>{for(const t of e)if(t.type==="childList")for(const i of t.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&s(i)}).observe(document,{childList:!0,subtree:!0});function a(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?t.credentials="include":e.crossOrigin==="anonymous"?t.credentials="omit":t.credentials="same-origin",t}function s(e){if(e.ep)return;e.ep=!0;const t=a(e);fetch(e.href,t)}})();const O="189c7714-8a1c-4a77-963f-6b89d86e85a9";function N(){const o=localStorage.getItem("accessToken");return o||(console.error("No access token found."),null)}async function T(){const o=N(),n=localStorage.getItem("userName"),a=document.getElementById("creditInfo");if(!o||!n){a&&(a.style.display="none");return}try{const t=(await(await fetch(`https://v2.api.noroff.dev/auction/profiles/${n}`,{headers:{Authorization:`Bearer ${o}`,"X-Noroff-API-Key":O}})).json()).data.credits;a&&(a.style.display="inline-block",a.textContent=`Credits: ${t} kr`)}catch(s){console.error("Failed to fetch credits:",s),a&&(a.style.display="none")}}const $="https://v2.api.noroff.dev/auction/listings";let F=[],E=[],g=1;const w=21;let D;async function U(o){const n=document.createElement("div");n.id="bidModal",n.classList.add("fixed","top-0","left-0","w-full","h-full","bg-gray-800","bg-opacity-50","flex","justify-center","items-center");const a=document.createElement("div");a.classList.add("bg-gray-900","p-8","rounded-lg","w-96"),n.appendChild(a);const s=document.createElement("h3");s.classList.add("text-2xl","text-center","text-white","mb-4"),s.textContent="Place Your Bid";const e=document.createElement("p");e.classList.add("text-center","text-gray-400","mb-4"),e.textContent="Enter your bid amount for this listing.";const t=document.createElement("input");t.type="number",t.id="bidAmount",t.classList.add("w-full","p-2","rounded-md","mb-4","text-black"),t.placeholder="Enter bid amount",t.min=1;const i=document.createElement("div");i.classList.add("flex","justify-between");const c=document.createElement("button");c.textContent="Place Bid",c.classList.add("bg-blue-500","text-white","px-4","py-2","rounded-md");const r=document.createElement("button");r.textContent="Cancel",r.classList.add("bg-red-500","text-white","px-4","py-2","rounded-md"),i.append(c,r),a.append(s,e,t,i),document.body.appendChild(n),r.addEventListener("click",()=>{document.body.removeChild(n)}),c.addEventListener("click",async()=>{const u=parseFloat(document.getElementById("bidAmount").value);if(isNaN(u)||u<=0){alert("Please enter a valid bid amount.");return}const m=N();if(!m){alert("You are not authenticated.");return}try{const d=await fetch(`${$}/${o}/bids`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${m}`,"X-Noroff-API-Key":O},body:JSON.stringify({amount:u})}),l=await d.json();d.ok?(alert("Your bid has been placed successfully."),C()):alert(l.message||"Error placing bid."),document.body.removeChild(n)}catch(d){alert("Failed to place bid: "+d.message),console.error("Error placing bid:",d)}})}function Y(){const o=document.getElementById("app"),n=document.createElement("div");n.className="relative mb-4 max-w-md mx-auto";const a=document.createElement("span");a.textContent="🔍",a.className="absolute left-3 top-2.5 text-gray-400 pointer-events-none";const s=document.createElement("button");s.textContent="✖️",s.className="absolute right-3 top-2 text-gray-400 hover:text-white hidden",s.setAttribute("type","button");const e=document.createElement("input");e.type="text",e.id="searchInput",e.placeholder="Search by title...",e.className="w-full pl-10 pr-10 py-2 rounded-md bg-gray-800 text-white placeholder-gray-400 border border-gray-600 focus:outline-none focus:ring-2 focus:ring-blue-500 transition",e.addEventListener("input",()=>{const h=e.value.trim();s.classList.toggle("hidden",h===""),g=1,y()}),s.addEventListener("click",()=>{e.value="",s.classList.add("hidden"),g=1,y()}),n.append(a,s,e),o.appendChild(n);const t=document.createElement("select");t.id="sortSelect",t.className="bg-gray-800 text-white border border-gray-600 rounded-md py-2 px-3 mb-6 focus:outline-none focus:ring-2 focus:ring-blue-500 transition block mx-auto",[{value:"none",label:"No sorting"},{value:"newest",label:"Newest First"},{value:"oldest",label:"Oldest First"},{value:"mostBids",label:"Most Bids"},{value:"fewestBids",label:"Fewest Bids"},{value:"highestBid",label:"Highest Bid"},{value:"lowestBid",label:"Lowest Bid"}].forEach(({value:h,label:f})=>{const b=document.createElement("option");b.value=h,b.textContent=f,t.appendChild(b)}),o.appendChild(t);const i=document.createElement("div");i.className="flex items-center justify-center mb-6";const c=document.createElement("input");c.type="checkbox",c.id="activeOnly",c.className="mr-2 rounded text-blue-500 focus:ring-blue-500";const r=document.createElement("label");r.setAttribute("for","activeOnly"),r.textContent="Show only active listings",r.className="text-white",i.appendChild(c),i.appendChild(r),o.appendChild(i);const u=document.createElement("div");u.id="listings",u.className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6",o.appendChild(u);const m=document.createElement("div");m.id="pagination",m.className="flex justify-center items-center gap-4 mt-8";const d=document.createElement("button");d.id="prevPage",d.textContent="Previous",d.className="bg-gray-700 text-white px-4 py-2 rounded-md hover:bg-gray-600";const l=document.createElement("span");l.id="pageInfo",l.className="text-white";const p=document.createElement("button");p.id="nextPage",p.textContent="Next",p.className="bg-gray-700 text-white px-4 py-2 rounded-md hover:bg-gray-600",m.append(d,l,p),o.appendChild(m)}async function C(){try{F=(await(await fetch(`${$}?_bids=true&_sort=created&sortOrder=desc&limit=100`)).json()).data,y()}catch(o){console.error("Error fetching listings:",o)}}function y(){const o=document.getElementById("searchInput").value.toLowerCase(),n=document.getElementById("sortSelect").value,a=document.getElementById("activeOnly").checked;E=F.filter(s=>{const e=s.title.toLowerCase().includes(o),t=new Date(s.endsAt)>new Date;return e&&(!a||t)}),E.sort((s,e)=>{var u,m,d,l,p,h;const t=new Date(s.endsAt)>new Date,i=new Date(e.endsAt)>new Date;if(t&&!i)return-1;if(!t&&i)return 1;const c=(u=s.bids)!=null&&u.length?Math.max(...s.bids.map(f=>f.amount)):0,r=(m=e.bids)!=null&&m.length?Math.max(...e.bids.map(f=>f.amount)):0;switch(n){case"newest":return new Date(e.created)-new Date(s.created);case"oldest":return new Date(s.created)-new Date(e.created);case"mostBids":return(((d=e.bids)==null?void 0:d.length)||0)-(((l=s.bids)==null?void 0:l.length)||0);case"fewestBids":return(((p=s.bids)==null?void 0:p.length)||0)-(((h=e.bids)==null?void 0:h.length)||0);case"highestBid":return r-c;case"lowestBid":return c-r;default:return 0}}),I()}function I(){const o=document.getElementById("listings");o.innerHTML="";const n=!!localStorage.getItem("accessToken"),a=(g-1)*w,s=a+w,e=E.slice(a,s);if(e.length===0){const t=document.createElement("p");t.textContent="No results.",o.appendChild(t);return}e.forEach(t=>{var P,A,k,S,M;const i=document.createElement("div");i.classList.add("bg-gray-800","p-6","rounded-lg","shadow-md","hover:shadow-xl","transition","duration-300","ease-in-out");const c=((A=(P=t.media)==null?void 0:P[0])==null?void 0:A.url)||"https://via.placeholder.com/300x200?text=Ingen+bilde",r=((S=(k=t.media)==null?void 0:k[0])==null?void 0:S.alt)||"Placeholder-image",u=document.createElement("img");u.src=c,u.alt=r,u.loading="lazy",u.classList.add("w-full","h-48","object-cover","rounded-md","mb-4");const m=document.createElement("h3");m.classList.add("text-xl","font-semibold","text-gray-200","mb-2"),m.textContent=t.title;const d=document.createElement("p");d.classList.add("text-gray-400","mb-4"),d.textContent=t.description||"No description.";const l=document.createElement("div");l.classList.add("text-gray-300","mb-4");function p(){const x=new Date().getTime(),v=new Date(t.endsAt).getTime()-x;if(v<0)l.textContent="Auction ended",l.classList.remove("text-gray-300"),l.classList.add("text-red-400","font-semibold"),clearInterval(D);else{const j=Math.floor(v/864e5),q=Math.floor(v%(1e3*60*60*24)/(1e3*60*60)),H=Math.floor(v%(1e3*60*60)/(1e3*60)),K=Math.floor(v%(1e3*60)/1e3);l.textContent=`Time left: ${j}d ${q}h ${H}m ${K}s`,l.classList.remove("text-red-400","font-semibold"),l.classList.add("text-gray-300")}}p(),D=setInterval(p,1e3);const h=(M=t.bids)!=null&&M.length?Math.max(...t.bids.map(x=>x.amount)):0,f=document.createElement("div");f.classList.add("text-xl","font-semibold","text-gray-200","mb-2"),f.innerHTML=`<strong>Highest bid:</strong> ${h} kr`;const b=document.createElement("button");b.textContent="Place Bid",b.classList.add("bg-blue-500","text-white","px-4","py-2","rounded-md","mt-4","w-full"),b.addEventListener("click",x=>{x.preventDefault(),U(t.id)});const L=document.createElement("button");L.textContent="More Info",L.classList.add("bg-gray-500","text-white","px-4","py-2","rounded-md","mt-4","w-full"),L.addEventListener("click",()=>{window.location.href=`/html/single-listing.html?id=${t.id}`}),i.append(u,m,d,l,f),n&&i.appendChild(b),i.appendChild(L),o.appendChild(i)}),B()}function B(){const o=document.getElementById("pageInfo"),n=Math.ceil(E.length/w);o.textContent=`Page ${g} of ${n}`,document.getElementById("prevPage").disabled=g===1,document.getElementById("nextPage").disabled=g===n}document.addEventListener("DOMContentLoaded",()=>{Y(),C(),T(),window.addEventListener("listingCreated",()=>{C(),T()}),document.getElementById("searchInput").addEventListener("input",()=>{g=1,y()}),document.getElementById("sortSelect").addEventListener("change",()=>{g=1,y()}),document.getElementById("prevPage").addEventListener("click",()=>{g>1&&(g--,I(),B())}),document.getElementById("nextPage").addEventListener("click",()=>{const o=Math.ceil(E.length/w);g<o&&(g++,I(),B(),window.scrollTo(0,0))}),document.getElementById("activeOnly").addEventListener("change",()=>{g=1,y()})});function z(){const o=document.getElementById("menu-toggle"),n=document.getElementById("mobile-menu");o&&n&&o.addEventListener("click",()=>{n.classList.toggle("hidden")})}function R(){const o=localStorage.getItem("accessToken"),n=localStorage.getItem("userName"),a=document.querySelectorAll("nav .md\\:flex a"),s=document.querySelectorAll("#mobile-menu a");o&&n&&(a.forEach(e=>{e.textContent.trim()==="Login"&&(e.textContent="Profile",e.setAttribute("href",`/html/profile.html?name=${n}`)),e.textContent.trim()==="Register"&&(e.textContent="Create Listing",e.setAttribute("href","/html/create-listing.html"))}),s.forEach(e=>{e.textContent.trim()==="Login"&&(e.textContent="Profile",e.setAttribute("href",`/html/profile.html?name=${n}`)),e.textContent.trim()==="Register"&&(e.textContent="Create Listing",e.setAttribute("href","/html/create-listing.html"))}))}function W(){if(!localStorage.getItem("accessToken"))return;const n=document.createElement("button");n.textContent="Logout",n.className="text-gray-200 hover:bg-red-700 bg-red-600 px-3 py-2 rounded-md",n.id="logout-btn";const a=document.querySelector(".md\\:flex.space-x-6");a&&a.appendChild(n);const s=document.getElementById("mobile-menu");if(s){const e=n.cloneNode(!0);e.classList.add("block","w-full"),s.appendChild(e)}}function _(){document.addEventListener("click",function(o){o.target&&o.target.id==="logout-btn"&&(localStorage.removeItem("accessToken"),localStorage.removeItem("user"),window.location.href="/")})}function X(){const o=N(),n=localStorage.getItem("userName"),a=o&&n,s=document.getElementById("nav-all-profiles"),e=document.getElementById("nav-profile"),t=document.getElementById("mobile-all-profiles"),i=document.getElementById("mobile-profile");function c(r){r&&(r.style.display=a?"inline-block":"none")}c(s),c(e),c(t),c(i)}document.addEventListener("DOMContentLoaded",()=>{z(),R(),W(),_(),X()});
